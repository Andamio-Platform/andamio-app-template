# Design Proposal: 2026-01-27

## Context

**Feedback Source:** Instructor dashboard testing session (PR #92)
**Iteration:** 2026-01-27

## Executive Summary

The learner journey lacks visibility into progress and connection to the project ecosystem. After completing a module assignment, learners see only "Enrolled" with no indication of what they've achieved or unlocked. This proposal enhances the existing dashboard and course pages to show **per-module progress** and **project prerequisite unlocks** - connecting learning achievements to real project contribution opportunities.

## The RPG Model

Think of it like an RPG skill tree:
```
[Complete Module] â†’ [Earn Credential (slt_hashes)] â†’ [Progress toward Project Prerequisites]
                                                              â†“
                                              "1/3 credentials for Project Alpha"
                                                              â†“
                                              "You can join Project Alpha!"
```

**Key Definitions:**
- **Credential** = A list of slt_hashes (corresponds to a completed course module)
- **Project Prerequisite** = course_id + list of slt_hashes (can span multiple modules/courses)
- **Earning a Credential** = When a teacher approves a module assignment (ASSIGNMENT_ACCEPTED)

---

## Problems & Solutions

### Problem 1: No Per-Module Progress Visibility

**From Feedback:**
> "I've approved an assignment for a learner. But this is not reflected on my learner's dashboard... What is missing is the UX to guide the learner through their journey."

**Root Cause Analysis:**
`UserCourseStatus` shows only "Enrolled" or "Course Complete!" because it only uses `useStudentCourses()` which returns course-level `enrollment_status`. The API has `POST /api/v2/course/student/assignment-commitments/list` which returns all commitments with their status, but this isn't being used.

**Proposed Solution:**

| Aspect | Detail |
|--------|--------|
| Change | Create `useStudentAssignmentCommitments` hook + enhance `UserCourseStatus` component |
| Rationale | Uses existing API endpoint, no backend changes needed |
| Files | `src/hooks/api/course/use-course-student.ts`, `src/components/learner/user-course-status.tsx` |
| Components | Enhanced: `UserCourseStatus` to show per-module progress |

**Visual:**
```
Before: UserCourseStatus
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ Enrolled                     â”‚
â”‚ You're enrolled in this course â”‚
â”‚ Continue working through       â”‚
â”‚ modules...                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After: UserCourseStatus with progress
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Your Progress                     2/5 done  â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 40%                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Module 101  âœ“ Completed    [Claim Cred â†’]  â”‚
â”‚ Module 102  âœ“ Completed                     â”‚
â”‚ Module 103  â³ Pending Review               â”‚
â”‚ Module 104  â—‹ Not Started                   â”‚
â”‚ Module 105  â—‹ Not Started                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Alternatives Considered:**
1. Fetch each module status individually - Rejected because N+1 API calls
2. Modify the student courses endpoint - Rejected because requires backend changes

---

### Problem 2: CourseModuleCard Doesn't Show Learner's Assignment Status

**From Feedback:**
> "Which assignments are completed, pending, or still to do?"

**Root Cause Analysis:**
`CourseModuleCard` is a stateless display component that shows module info (title, SLTs) but doesn't receive or display learner progress. It's the same for visitors and enrolled learners.

**Proposed Solution:**

| Aspect | Detail |
|--------|--------|
| Change | Add optional `learnerStatus` prop to show progress badge |
| Rationale | Non-breaking - works for visitors (no badge) and learners (shows status) |
| Files | `src/components/courses/course-module-card.tsx` |
| Components | Updated: `CourseModuleCard` |

**Visual:**
```
Visitor view (no change):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [101]  Module Title          3 targets â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Learner view with status:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [101]  Module Title   âœ“ Completed      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [102]  Module Title   â³ Pending Reviewâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Problem 3: No "Claim Credential" Trigger When Module Completed

**From Feedback:**
> "A very important part of the learner journey is 'Claiming Credentials'... after claiming their credential they WILL have to re-enroll BUT they have the benefit of a) having that credential in their access token and b) they can use that credential to access projects."

**Root Cause Analysis:**
The `CredentialClaim` component exists and is shown in `AssignmentCommitment` when status is `ASSIGNMENT_ACCEPTED`, but there's no prominent call-to-action in the course overview. The learner has to navigate into each module to discover they can claim.

**Proposed Solution:**

| Aspect | Detail |
|--------|--------|
| Change | Show credential claim prompt in `UserCourseStatus` for completed modules |
| Rationale | Makes claimable credentials visible at course level, not buried in module pages |
| Files | `src/components/learner/user-course-status.tsx` |
| Components | Enhanced: `UserCourseStatus` includes claim buttons |

**Visual:**
```
Module completed - claim available:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Module 101  âœ“ Completed                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ðŸŽ‰ Ready to claim credential!                        â”‚â”‚
â”‚ â”‚ Claiming adds this credential to your access token.  â”‚â”‚
â”‚ â”‚ Note: You'll need to re-enroll to continue.          â”‚â”‚
â”‚ â”‚ [Claim Credential]                                   â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Problem 4: No Project Unlock Progress After Earning Credentials

**From Feedback:**
> "The trigger would know all project prerequisites... and IF it sees that a learner has earned a credential that gives them access to a project or starts getting them there (you've earned 1 of 3 credentials), that is shown to them."

**Root Cause Analysis:**
The infrastructure exists (`checkProjectEligibility`, `useProjects` with prerequisites) but there's no UI that cross-references a learner's completed modules against all project prerequisites. The connection between learning and projects is invisible.

**Proposed Solution:**

| Aspect | Detail |
|--------|--------|
| Change | Create `ProjectUnlockProgress` component that shows prerequisite progress |
| Rationale | Connects learning achievements to project opportunities - the core value prop |
| Files | `src/components/learner/project-unlock-progress.tsx` (new) |
| Components | New: `ProjectUnlockProgress`, displayed in `UserCourseStatus` and Dashboard |

**Visual:**
```
After completing a module that counts toward a project:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ”“ Project Progress                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Project Alpha          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 2/3 prerequisites    â”‚
â”‚ Need: Module 103 from "Advanced Cardano"                â”‚
â”‚                                                         â”‚
â”‚ Project Beta           â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ Ready to join!       â”‚
â”‚ [Join as Contributor â†’]                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Implementation Notes:**
- Uses existing `useProjects()` to get all projects with prerequisites
- Uses existing `checkProjectEligibility()` or similar logic to match user's completed modules
- Shows only projects where user has >= 1 prerequisite met (don't show 0/3 projects)

---

### Problem 5: Unclear Status Labels

**From Feedback:**
> Status shows "Unknown" in instructor view, and learners don't understand what "PENDING_APPROVAL" means

**Root Cause Analysis:**
The API returns technical status strings like `PENDING_APPROVAL`, `ASSIGNMENT_ACCEPTED` which are developer-facing, not user-facing.

**Proposed Solution:**

| Aspect | Detail |
|--------|--------|
| Change | Create status mapping utility with user-friendly labels and colors |
| Rationale | Single source of truth for status display across all components |
| Files | `src/lib/assignment-status.ts` (new) |
| Components | Used by: `UserCourseStatus`, `CourseModuleCard`, `AssignmentCommitment` |

**Status Mapping:**
```typescript
const ASSIGNMENT_STATUS_MAP = {
  "NOT_STARTED":         { label: "Not Started",      variant: "outline",     icon: CircleIcon },
  "IN_PROGRESS":         { label: "In Progress",      variant: "secondary",   icon: PencilIcon },
  "DRAFT":               { label: "Draft",            variant: "outline",     icon: FileIcon },
  "PENDING_APPROVAL":    { label: "Pending Review",   variant: "secondary",   icon: ClockIcon },
  "ASSIGNMENT_ACCEPTED": { label: "Completed",        variant: "default",     icon: SuccessIcon },
  "ASSIGNMENT_DENIED":   { label: "Needs Revision",   variant: "destructive", icon: XCircleIcon },
  "CREDENTIAL_CLAIMED":  { label: "Credential Earned",variant: "default",     icon: CredentialIcon },
} as const;
```

---

## Design Spec

### Experience Goals
- Make the learner journey visible: "I completed X, it unlocked Y."
- Reduce ambiguity around status by pairing labels with icons and short helper text.
- Promote credential claiming at the course overview level without forcing module deep dives.
- Keep the UI familiar: evolve existing cards instead of introducing new flows.

### Information Architecture
**Primary surfaces**
1. **Course detail page**: `UserCourseStatus` (top of course page)
2. **Course module list**: `CourseModuleCard` (within course page)
3. **Learner dashboard**: `ProjectUnlockProgress` (below "Your Courses" section)

### Layout (Course Detail)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Your Progress                              2/5 done 40%  â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                               (CTA) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Module 101  [Completed]  [Claim Credential]               â”‚
â”‚   "Adds credential to your access token"                  â”‚
â”‚ Module 102  [Pending Review]                              â”‚
â”‚ Module 103  [Not Started]                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Card sections**
- **Header**: "Your Progress" + numeric summary + progress bar
- **Module rows**: Title + status badge + optional CTA
- **Claim inline panel**: appears only when `ASSIGNMENT_ACCEPTED` and not claimed

### Component Behavior

**1) UserCourseStatus (enhanced)**
- Compute `completedCount` as statuses in `{ASSIGNMENT_ACCEPTED, CREDENTIAL_CLAIMED}`.
- Show progress bar + count even when zero (use empty state copy).
- For each module:
  - Status badge from `ASSIGNMENT_STATUS_MAP`
  - If `ASSIGNMENT_ACCEPTED` and not claimed: show "Claim Credential" CTA
  - If `CREDENTIAL_CLAIMED`: show "Credential Earned" tag + optional "Re-enroll" link

**Claim Credential inline panel copy**
```
Title: Ready to claim credential
Body: Claiming adds this credential to your access token.
Note: You may need to re-enroll to continue the course.
CTA: Claim Credential
Secondary: Learn more
```

**2) CourseModuleCard (learner view)**
- Add `learnerStatus?: AssignmentStatus`.
- Right-align status badge; hide if undefined.
- Keep module target count visible to avoid losing context.

**3) ProjectUnlockProgress (new)**
- Show only projects where user has >= 1 prerequisite met.
- Two states:
  - **In Progress**: progress bar + "Need: Module 103 from Advanced Cardano"
  - **Ready**: "Ready to join!" + primary CTA "Join as Contributor"

### Interaction Flow
1. Learner completes assignment -> status becomes `PENDING_APPROVAL`
2. Instructor approves -> status `ASSIGNMENT_ACCEPTED`
3. Course overview now shows "Claim Credential" CTA
4. On claim:
   - Status becomes `CREDENTIAL_CLAIMED`
   - Project progress recalculates and card updates

### Status Display Rules
- Always show label + icon (do not rely on color alone).
- Use short helper text only in expanded contexts (UserCourseStatus).
- Avoid technical status names in UI.

### Empty / Edge States
- **No commitments**: show "Start Module 1" CTA and 0% progress.
- **Mixed course prerequisites**: display next missing prerequisite as "Need: Module X from Course Y".
- **Claimed but not re-enrolled**: show neutral info banner "Re-enroll to continue this course".

### Responsive Behavior
- Desktop: `UserCourseStatus` full width; `ProjectUnlockProgress` as separate card below.
- Mobile: stack module rows, move status badge below title, keep CTA full-width.

### Accessibility
- Badges: include text + icon + `aria-label` for status.
- Progress bars: include `aria-valuenow` + text summary ("2 of 5 modules complete").
- CTAs: ensure warning copy for re-enroll is readable and not only color-signaled.

---

## Impact Assessment

| # | Problem | Solution | Impact | Effort | Risk |
|---|---------|----------|--------|--------|------|
| 5 | Unclear status labels | Status mapping utility | Med | Low | None |
| 1 | No per-module progress | `useStudentAssignmentCommitments` hook | High | Med | API may need parsing |
| 2 | CourseModuleCard no status | Add `learnerStatus` prop | Med | Low | None |
| 3 | No claim credential trigger | Enhance `UserCourseStatus` | High | Med | Needs re-enroll messaging |
| 4 | No project unlock progress | `ProjectUnlockProgress` component | High | Med | Cross-references multiple APIs |

## Dependencies

**Implementation Order:**
1. **Solution 5** - Status mapping utility (foundation - used by everything else)
2. **Solution 1** - `useStudentAssignmentCommitments` hook (data layer)
3. **Solution 2** - `CourseModuleCard` learnerStatus prop
4. **Solution 3** - Credential claim triggers in `UserCourseStatus`
5. **Solution 4** - Project unlock progress (depends on 1, uses existing project hooks)

## Out of Scope

- Creating new routes (use existing dashboard, course detail pages)
- Backend API changes
- Instructor view improvements (covered in PR #92)
- Handling multi-module prerequisites across multiple courses (will show progress but complex UX deferred)
- Notification system for status changes

## Open Questions

1. **Re-enrollment Flow**: After claiming a credential, what's the exact user action to re-enroll? Does the system auto-remove the enrollment, or does the learner stay "enrolled" but with the module marked as "credential claimed"?

2. **Multiple Prerequisites**: When a project requires modules from multiple courses, should we show each course's progress separately, or aggregate into one progress bar?

3. **Project Discovery**: Should we show ALL projects the user is making progress toward, or only projects where they have >=50% prerequisites complete?

---

*Generated by /product-iteration Phase 2: DESIGN*
