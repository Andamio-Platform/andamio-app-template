# Session Archive: January 5-11, 2026

> Sessions 1-4 covering Go API migration, type package updates, wallet auth fixes, and API coverage audit.

---

## January 10, 2026 (Session 4) - API Migration & Transaction Fixes

**Go API RESTful Migration Complete**: Migrated all 50+ API endpoint calls to new role-based path structure.

**Migration Pattern**: Changed from `POST /endpoint` with body to `GET /{system}/{role}/{resource}/{action}` with path params.

**Example Changes**:
- `POST /course/list` → `GET /course/owner/courses/list`
- `POST /course/get` → `GET /course/user/course/get/{policy_id}`
- `POST /assignment-commitment/create` → `POST /course/student/assignment-commitment/create`

**Files Updated**: 36 files across hooks, components, and pages. Full audit report at `.claude/skills/audit-api-coverage/API-AUDIT-2026-01-10.md`.

**Transaction Partial Signing Fix**: Fixed Eternl wallet "ErrorSignTx.canOnlySignPartially" error.
- Added `partialSign` property to `AndamioTransactionDefinition` type
- Set `partialSign: true` on `INSTANCE_PROJECT_CREATE` definition
- Updated `useAndamioTransaction` to pass through `partialSign` from definition

**Null Safety Fix**: Fixed `truncateTxHash` crash when `txHash` is undefined in `PendingTxPopover`.

**Project Dashboard Role Detection**: `/studio/project/[treasurynft]` now detects both owner and manager roles.
- Owners see an info banner explaining their capabilities
- Managers can fully manage the project
- Uses Andamioscan `getManagingProjects` to check manager status via on-chain data

**Skill Consolidation**: Merged 3 styling skills into unified `design-system` skill with 3 modes: `review`, `diagnose`, `reference`.

---

## January 10, 2026 (Session 3) - Eternl Wallet Authentication Fixed

**Fixed Authentication for Eternl Wallet**: Wallet-based authentication now works with Eternl and other wallets that return hex-encoded addresses.

**Root Causes Found & Fixed**:
1. **Address Format Mismatch**: Eternl returns hex addresses (e.g., `00db...`), but Mesh SDK's `signData` was internally calling `Address.fromBech32()` which failed on hex input.
2. **Parameter Order Reversed**: Mesh SDK ISigner interface expects `signData(payload, address?)` but we were calling `signData(address, payload)`.

**Solution** (`src/contexts/andamio-auth-context.tsx`):
- Import `core` from `@meshsdk/core`
- Detect address format: if starts with "addr" it's already bech32, otherwise convert
- Convert hex → bech32 using `core.Address.fromString(hex).toBech32()`
- Fixed parameter order: `wallet.signData(nonce, bech32Address)`

**Testing Status**:
- Eternl wallet (preprod) - authentication successful
- Other wallets (Nami, Flint, Yoroi, Lace) - needs testing

**Skill Consolidation**:
- Merged `global-style-checker`, `review-styling`, `theme-expert` → **`design-system`** (3 modes: review, diagnose, reference)
- Merged `plan-andamioscan-integration` → **`audit-api-coverage`** (added Phase 3 interview workflows)
- Fixed ESLint warnings across 7 files

---

## January 10, 2026 (Session 2) - API Coverage Audit Complete

**Full API Audit**: Completed comprehensive audit of all 3 API sub-systems.

**Coverage Statistics**:
| API | Endpoints | Implemented | Coverage |
|-----|-----------|-------------|----------|
| Andamio DB API | 73 | 18 hooks | 25% |
| Andamio Tx API | 16 | 16 definitions | 100% |
| Andamioscan | 36 | 21 functions | 58% |
| **Total** | **125** | **55** | **44%** |

**Documentation Created**:
- `audit-api-coverage/db-api-endpoints.md` - 73 endpoints by category
- `audit-api-coverage/tx-api-endpoints.md` - 16 transaction mappings
- `audit-api-coverage/andamioscan-endpoints.md` - 36 endpoints + 21 client functions
- `audit-api-coverage/api-coverage-report-2026-01-10.md` - Full report with recommendations
- `audit-api-coverage/api-coverage.md` - Updated quick reference

**Key Findings**:
1. **Tx API 100% Complete** - All 16 transaction types have definitions and UI components
2. **16 Event endpoints missing** - Andamioscan event endpoints would replace Koios polling
3. **Assignment system gap** - 12 DB API endpoints need hooks for student interactions
4. **Cache invalidation needed** - React Query invalidation after mutations needs audit

---

## January 10, 2026 (Session 1) - Types Package Migration Complete

**Major Migration**: Completed migration from `@andamio/db-api` to `@andamio/db-api-types@1.1.0` and `@andamio/transactions@0.5.0`.

**Type Changes** (38 files updated):
| Old Type | New Type |
|----------|----------|
| `ListOwnedCoursesOutput` | `CourseListResponse` |
| `CourseOutput` | `CourseResponse` |
| `CourseModuleOutput` | `CourseModuleResponse` |
| `LessonWithSLTResponse` | `LessonResponse` |
| `AssignmentCommitmentWithAssignmentResponse` | `AssignmentCommitmentResponse` |

**Property Renames**:
- `slt_index` → `module_index` (on SLTs and lessons)
- `task.index` → `task.task_index`
- `learner_access_token_alias` → `access_token_alias`
- Flattened `commitment.assignment.*` → `commitment.module_code`, `commitment.assignment_title`

**Status Enum Changes**: `DRAFT | PENDING_TX | ON_CHAIN` (APPROVED removed)

**Removed Data** (UI simplified):
- Treasury: `total_ada`, `escrows`, `_count`
- Commitments: `created`, `updated` timestamps
- Tokens: `subject`, `name`, `ticker`, `asset_name_decoded`

**Transaction Renames**:
- `COMMIT_TO_ASSIGNMENT` → `COURSE_STUDENT_ASSIGNMENT_COMMIT`
- `BURN_LOCAL_STATE` → `COURSE_STUDENT_CREDENTIAL_CLAIM`
- `LEAVE_ASSIGNMENT` → `COURSE_STUDENT_ASSIGNMENT_UPDATE`
- `ACCEPT_ASSIGNMENT` + `DENY_ASSIGNMENT` → `COURSE_TEACHER_ASSIGNMENTS_ASSESS`

**All type errors resolved - typecheck passes.**

---

## January 9, 2026 (Session 2) - Go API Migration Complete

**Andamio DB API (Go) Now Live**: Migrated all T3 App endpoints to match the new Go API.

**Endpoint Migrations**:
| Old Endpoint | New Endpoint | Files Updated |
|--------------|--------------|---------------|
| `POST /course/list` | `GET /courses/owned` | 5 files |
| `POST /course-module/map` | `POST /course-modules/list` | 2 files |
| `POST /my-learning/get` | `GET /learner/my-learning` | 1 file |
| `POST /access-token/update-alias` | `POST /user/access-token-alias` | 2 files |
| `POST /access-token/update-unconfirmed-tx` | `PATCH /user/unconfirmed-tx` | 2 files |
| `GET /transaction/pending-transactions` | `GET /pending-transactions` | 2 files |

**Fixed Issues**:
- CORS configuration on Cloud Run
- Invalid signature error (Mesh SDK `signData` requires address parameter - pending fix)
- Null safety for `tx.context` in pending-tx-popover

---

## January 9, 2026 (Session 1) - Transaction Component Audit Complete

**Transaction System Audit**: All 16 V2 transaction components verified to use `useAndamioTransaction` hook.

**MintAccessToken Updated**: Migrated from `useTransaction` to `useAndamioTransaction` (hybrid approach). Now executes `onSubmit` side effects automatically while manually handling JWT storage.

**Documentation Updated**:
- `TRANSACTION-COMPONENTS.md` - Full V2 transaction matrix with 16 components
- `SIDE-EFFECTS-INTEGRATION.md` - Added MintAccessToken hybrid approach section
- `CHANGELOG.md` - Added hook migration note

**Blockers Documented**: Added "Current Blockers" section to STATUS.md tracking:
- @andamio/transactions NPM publish (waiting)
- Andamio DB API Go rewrite (waiting for deployment)
- Event endpoints for transaction confirmation (0/15)

---

## January 8, 2026 - Andamioscan Integration Complete

**Andamioscan API Integration**: Completed all Course, User, and Project endpoints (17/32, 53%)

**New Endpoints Implemented**:
- `GET /v2/users/{alias}/projects/contributing` - Dashboard summary
- `GET /v2/users/{alias}/projects/managing` - Dashboard summary (managers only)
- `GET /v2/users/{alias}/projects/owned` - Project ownership check
- `GET /v2/users/{alias}/projects/completed` - Project credentials
- `GET /v2/projects/{id}/contributors/{alias}/status` - Contributor progress
